# @eficy/reactive - LLM Documentation

## é¡¹ç›®æ¦‚è¿°

@eficy/reactive æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å“åº”å¼çŠ¶æ€ç®¡ç†åº“ï¼ŒåŸºäº @preact/signals-core æ„å»ºï¼Œæä¾›äº†è£…é¥°å™¨é£æ ¼å’Œå‡½æ•°å¼é£æ ¼çš„å“åº”å¼ç¼–ç¨‹æ”¯æŒã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ”„ åŸºäº signals çš„ç»†ç²’åº¦å“åº”å¼æ›´æ–°
- ğŸ¯ æ”¯æŒè£…é¥°å™¨ (@Observable, @Computed, @Action) 
- ğŸ“¦ å‡½æ•°å¼ API (signal, effect, batch)
- âš¡ é«˜æ€§èƒ½çš„å“åº”å¼ç³»ç»Ÿ
- ğŸ”§ ä¸å¯å˜æ›´æ–°æ¨¡å¼
- ğŸ“Š å“åº”å¼é›†åˆæ”¯æŒ (ref, watch, observe)
- ğŸ› ï¸ ä¸°å¯Œçš„å·¥å…·å‡½æ•°
- ğŸ“± TypeScript åŸç”Ÿæ”¯æŒ

### æŠ€æœ¯æ¶æ„
- åŸºäº @preact/signals-core
- TypeScript ç¼–å†™
- reflect-metadata æ”¯æŒè£…é¥°å™¨
- æ¨¡å—åŒ–è®¾è®¡
- é›¶ä¾èµ–ï¼ˆé™¤ signals-coreï¼‰

## æ ¸å¿ƒæ¦‚å¿µ

### 1. å“åº”å¼èŒƒå¼

#### ä¼ ç»Ÿ MobX é£æ ¼ (å·²ç§»é™¤)
```typescript
// âŒ æ—§æ–¹å¼ - ç›´æ¥ä¿®æ”¹
this.todos.push(newTodo)
this.todos[0].completed = true
```

#### æ–°çš„ä¸å¯å˜æ›´æ–°èŒƒå¼
```typescript
// âœ… æ–°æ–¹å¼ - ä¸å¯å˜æ›´æ–°
this.todos = [...this.todos, newTodo]
this.todos = this.todos.map(todo => 
  todo.id === id ? { ...todo, completed: !todo.completed } : todo
)
```

### 2. åŒé‡ API è®¾è®¡

#### è£…é¥°å™¨é£æ ¼ (æ¨è)
```typescript
class UserStore extends ObservableClass {
  @Observable name = ''
  @Observable age = 0
  
  @Computed get isAdult() {
    return this.age >= 18
  }
  
  @Action updateProfile(name: string, age: number) {
    this.name = name
    this.age = age
  }
}
```

#### å‡½æ•°å¼é£æ ¼
```typescript
import { signal, computed, createAction } from '@eficy/reactive'

const name = signal('')
const age = signal(0)
const isAdult = computed(() => age.value >= 18)
const updateProfile = createAction((newName: string, newAge: number) => {
  name.value = newName
  age.value = newAge
})
```

## API å‚è€ƒ

### è£…é¥°å™¨ API (ä¼˜å…ˆçº§æœ€é«˜)

#### @Observable è£…é¥°å™¨
```typescript
class Store extends ObservableClass {
  // åŸºç¡€ç”¨æ³•
  @Observable name = 'John'
  
  // å¸¦åˆå§‹å€¼
  @Observable(0) count!: number
  
  // å¤æ‚ç±»å‹
  @Observable users: User[] = []
  @Observable config: Config = { theme: 'light' }
}
```

#### @Computed è£…é¥°å™¨
```typescript
class Store extends ObservableClass {
  @Observable firstName = ''
  @Observable lastName = ''
  
  @Computed get fullName() {
    return `${this.firstName} ${this.lastName}`
  }
  
  @Computed get stats() {
    return {
      userCount: this.users.length,
      activeUsers: this.users.filter(u => u.active).length
    }
  }
}
```

#### @Action è£…é¥°å™¨
```typescript
class Store extends ObservableClass {
  @Observable items: Item[] = []
  
  @Action addItem(item: Item) {
    // ä¸å¯å˜æ›´æ–°
    this.items = [...this.items, item]
  }
  
  @Action('remove item by id') // å¸¦åç§°
  removeItem(id: string) {
    this.items = this.items.filter(item => item.id !== id)
  }
  
  @Action bulkUpdate(updates: Partial<Store>) {
    // æ‰¹é‡æ›´æ–°ä¼šè‡ªåŠ¨æ‰¹å¤„ç†
    Object.assign(this, updates)
  }
}
```

#### makeObservable å‡½æ•°
```typescript
class UserStore {
  name = ''
  age = 0
  
  constructor() {
    makeObservable(this) // è‡ªåŠ¨å¤„ç†è£…é¥°å™¨
  }
  
  get isAdult() {
    return this.age >= 18
  }
  
  updateAge(age: number) {
    this.age = age
  }
}
```

#### ObservableClass åŸºç±»
```typescript
// ç»§æ‰¿ ObservableClass è‡ªåŠ¨è°ƒç”¨ makeObservable
class Store extends ObservableClass {
  @Observable data = []
  
  @Computed get count() {
    return this.data.length
  }
  
  @Action clear() {
    this.data = []
  }
}

const store = new Store() // è‡ªåŠ¨å“åº”å¼
```

### æ ¸å¿ƒ Signals API

#### signal - åˆ›å»ºå“åº”å¼å€¼
```typescript
import { signal } from '@eficy/reactive'

// åŸºç¡€ä¿¡å·
const count = signal(0)
const name = signal('John')
const user = signal({ id: 1, name: 'Alice' })

// è¯»å–å€¼
console.log(count.value) // 0
console.log(name.value) // 'John'

// æ›´æ–°å€¼
count.value = 10
name.value = 'Jane'

// ä¸å¯å˜æ›´æ–°å¤æ‚å¯¹è±¡
user.value = { ...user.value, name: 'Bob' }
```

#### effect - å“åº”å‰¯ä½œç”¨
```typescript
import { signal, effect } from '@eficy/reactive'

const count = signal(0)
const name = signal('')

// åŸºç¡€ effect
const dispose = effect(() => {
  console.log(`Count is ${count.value}`)
})

// å¤šä¾èµ– effect
effect(() => {
  console.log(`User: ${name.value}, Count: ${count.value}`)
})

// æ¸…ç† effect
dispose()

// æ¡ä»¶ effect
effect(() => {
  if (count.value > 10) {
    console.log('Count is high!')
  }
})
```

#### computed - è®¡ç®—å€¼
```typescript
import { signal, computed } from '@eficy/reactive'

const firstName = signal('John')
const lastName = signal('Doe')

const fullName = computed(() => {
  return `${firstName.value} ${lastName.value}`
})

console.log(fullName.value) // 'John Doe'

firstName.value = 'Jane'
console.log(fullName.value) // 'Jane Doe'

// å¤æ‚è®¡ç®—
const users = signal([
  { name: 'Alice', active: true },
  { name: 'Bob', active: false }
])

const activeUsers = computed(() => {
  return users.value.filter(user => user.active)
})

const userStats = computed(() => {
  const all = users.value
  const active = activeUsers.value
  return {
    total: all.length,
    active: active.length,
    inactive: all.length - active.length
  }
})
```

#### batch - æ‰¹å¤„ç†æ›´æ–°
```typescript
import { signal, batch } from '@eficy/reactive'

const firstName = signal('John')
const lastName = signal('Doe')
const age = signal(25)

// æ‰¹å¤„ç†å¤šä¸ªæ›´æ–°
batch(() => {
  firstName.value = 'Jane'
  lastName.value = 'Smith'
  age.value = 30
})

// effect åªä¼šè§¦å‘ä¸€æ¬¡
effect(() => {
  console.log(`${firstName.value} ${lastName.value}, age ${age.value}`)
})
```

#### createAction - åˆ›å»ºåŠ¨ä½œ
```typescript
import { signal, createAction } from '@eficy/reactive'

const todos = signal<Todo[]>([])
const filter = signal<'all' | 'active' | 'completed'>('all')

// è‡ªåŠ¨æ‰¹å¤„ç†çš„åŠ¨ä½œ
const addTodo = createAction((text: string) => {
  const newTodo = {
    id: Date.now(),
    text,
    completed: false
  }
  todos.value = [...todos.value, newTodo]
})

const toggleTodo = createAction((id: number) => {
  todos.value = todos.value.map(todo =>
    todo.id === id ? { ...todo, completed: !todo.completed } : todo
  )
})

const setFilter = createAction((newFilter: typeof filter.value) => {
  filter.value = newFilter
})

// å¤æ‚åŠ¨ä½œ
const bulkToggle = createAction((ids: number[]) => {
  todos.value = todos.value.map(todo =>
    ids.includes(todo.id) ? { ...todo, completed: !todo.completed } : todo
  )
})
```

### Watch API

#### watch - è§‚å¯Ÿå˜åŒ–
```typescript
import { signal, watch } from '@eficy/reactive'

const count = signal(0)
const user = signal({ name: 'John' })

// åŸºç¡€ watch
const stopWatching = watch(count, (newValue, oldValue) => {
  console.log(`Count changed from ${oldValue} to ${newValue}`)
})

// ç«‹å³è§¦å‘
watch(count, (value) => {
  console.log(`Current count: ${value}`)
}, { immediate: true })

// æ·±åº¦ watch
watch(user, (newUser, oldUser) => {
  console.log('User changed:', newUser)
}, { deep: true })

// åœæ­¢è§‚å¯Ÿ
stopWatching()
```

#### watchMultiple - è§‚å¯Ÿå¤šä¸ªå€¼
```typescript
import { signal, watchMultiple } from '@eficy/reactive'

const firstName = signal('John')
const lastName = signal('Doe')
const age = signal(25)

watchMultiple([firstName, lastName, age], ([first, last, userAge]) => {
  console.log(`User: ${first} ${last}, Age: ${userAge}`)
})
```

#### watchOnce - å•æ¬¡è§‚å¯Ÿ
```typescript
import { signal, watchOnce } from '@eficy/reactive'

const isReady = signal(false)

watchOnce(isReady, (ready) => {
  if (ready) {
    console.log('System is ready!')
    // åªä¼šè§¦å‘ä¸€æ¬¡
  }
})
```

#### watchDebounced - é˜²æŠ–è§‚å¯Ÿ
```typescript
import { signal, watchDebounced } from '@eficy/reactive'

const searchTerm = signal('')

watchDebounced(searchTerm, (term) => {
  // æœç´¢ API è°ƒç”¨
  console.log(`Searching for: ${term}`)
}, { wait: 300 })
```

### Ref API

#### ref - å“åº”å¼å¼•ç”¨
```typescript
import { ref, isRef, unref } from '@eficy/reactive'

// åˆ›å»ºå¼•ç”¨
const count = ref(0)
const user = ref({ name: 'John' })

// è®¿é—®å€¼
console.log(count.value) // 0
console.log(user.value.name) // 'John'

// æ›´æ–°å€¼
count.value++
user.value = { ...user.value, name: 'Jane' }

// ç±»å‹æ£€æŸ¥
if (isRef(count)) {
  console.log('count is a ref')
}

// è·å–åŸå§‹å€¼
const rawValue = unref(count) // å¦‚æœæ˜¯ ref è¿”å› .valueï¼Œå¦åˆ™è¿”å›åŸå€¼
```

#### toRef å’Œ toRefs
```typescript
import { signal, toRef, toRefs } from '@eficy/reactive'

const user = signal({
  name: 'John',
  age: 25,
  email: 'john@example.com'
})

// åˆ›å»ºå•ä¸ªå±æ€§çš„ ref
const name = toRef(user, 'name')
console.log(name.value) // 'John'

// åˆ›å»ºæ‰€æœ‰å±æ€§çš„ refs
const { age, email } = toRefs(user.value)
console.log(age.value) // 25
console.log(email.value) // 'john@example.com'
```

### Observe API

#### observe - æ·±åº¦è§‚å¯Ÿ
```typescript
import { signal, observe } from '@eficy/reactive'

const state = signal({
  user: { name: 'John', preferences: { theme: 'dark' } },
  settings: { notifications: true }
})

// è§‚å¯Ÿæ•´ä¸ªå¯¹è±¡çš„å˜åŒ–
observe(state, (change) => {
  console.log('State changed:', change)
})

// è§‚å¯Ÿç‰¹å®šè·¯å¾„
observeProperty(state, 'user.name', (newName) => {
  console.log(`User name changed to: ${newName}`)
})
```

#### observeArray - æ•°ç»„è§‚å¯Ÿ
```typescript
import { signal, observeArray } from '@eficy/reactive'

const items = signal<string[]>([])

observeArray(items, (changes) => {
  changes.forEach(change => {
    switch (change.type) {
      case 'add':
        console.log('Added:', change.item, 'at', change.index)
        break
      case 'remove':
        console.log('Removed:', change.item, 'from', change.index)
        break
      case 'update':
        console.log('Updated:', change.oldValue, 'to', change.newValue)
        break
    }
  })
})
```

### å·¥å…·å‡½æ•°

#### ç±»å‹æ£€æŸ¥
```typescript
import { 
  isSignal, isRef, isAction, isReactive,
  isFunction, isObject, isArray, isPrimitive 
} from '@eficy/reactive'

const count = signal(0)
const action = createAction(() => {})

console.log(isSignal(count)) // true
console.log(isAction(action)) // true
console.log(isObject({})) // true
console.log(isArray([])) // true
```

#### åŸå§‹å€¼è½¬æ¢
```typescript
import { toRaw, toJS, markRaw } from '@eficy/reactive'

const user = signal({ name: 'John', nested: { value: 1 } })

// è·å–åŸå§‹å€¼ï¼ˆæµ…å±‚ï¼‰
const raw = toRaw(user.value)

// æ·±åº¦è½¬æ¢ä¸ºæ™®é€š JS å¯¹è±¡
const plain = toJS(user.value)

// æ ‡è®°ä¸ºåŸå§‹å€¼ï¼Œä¸ä¼šè¢«å“åº”å¼åŒ–
const rawObj = markRaw({ data: 'static' })
```

#### è°ƒè¯•å·¥å…·
```typescript
import { createDebugger, createTimer } from '@eficy/reactive'

// åˆ›å»ºè°ƒè¯•å™¨
const debug = createDebugger('UserStore')
debug.log('User updated:', user)

// æ€§èƒ½è®¡æ—¶
const timer = createTimer()
timer.start('computation')
// ... ä¸€äº›è®¡ç®—
timer.end('computation')
timer.report() // è¾“å‡ºè®¡æ—¶ç»“æœ
```

## å®é™…ä½¿ç”¨ç¤ºä¾‹

### 1. TodoMVC ç¤ºä¾‹

```typescript
import { signal, computed, createAction, ObservableClass } from '@eficy/reactive'

interface Todo {
  id: number
  text: string
  completed: boolean
}

class TodoStore extends ObservableClass {
  @Observable todos: Todo[] = []
  @Observable filter: 'all' | 'active' | 'completed' = 'all'

  @Computed get filteredTodos() {
    switch (this.filter) {
      case 'active':
        return this.todos.filter(todo => !todo.completed)
      case 'completed':
        return this.todos.filter(todo => todo.completed)
      default:
        return this.todos
    }
  }

  @Computed get activeCount() {
    return this.todos.filter(todo => !todo.completed).length
  }

  @Computed get completedCount() {
    return this.todos.filter(todo => todo.completed).length
  }

  @Action addTodo(text: string) {
    const newTodo: Todo = {
      id: Date.now() + Math.random(),
      text,
      completed: false
    }
    this.todos = [...this.todos, newTodo]
  }

  @Action toggleTodo(id: number) {
    this.todos = this.todos.map(todo =>
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    )
  }

  @Action removeTodo(id: number) {
    this.todos = this.todos.filter(todo => todo.id !== id)
  }

  @Action setFilter(filter: typeof this.filter) {
    this.filter = filter
  }

  @Action clearCompleted() {
    this.todos = this.todos.filter(todo => !todo.completed)
  }

  @Action toggleAll() {
    const shouldCheck = this.activeCount > 0
    this.todos = this.todos.map(todo => ({
      ...todo,
      completed: shouldCheck
    }))
  }
}
```

### 2. ç”¨æˆ·ç®¡ç†ç¤ºä¾‹

```typescript
class UserManager extends ObservableClass {
  @Observable users: User[] = []
  @Observable currentUserId: string | null = null
  @Observable isLoading = false
  @Observable error: string | null = null

  @Computed get currentUser() {
    return this.users.find(user => user.id === this.currentUserId) || null
  }

  @Computed get activeUsers() {
    return this.users.filter(user => user.status === 'active')
  }

  @Computed get usersByRole() {
    return this.users.reduce((acc, user) => {
      const role = user.role
      if (!acc[role]) acc[role] = []
      acc[role].push(user)
      return acc
    }, {} as Record<string, User[]>)
  }

  @Action async loadUsers() {
    this.isLoading = true
    this.error = null
    
    try {
      const users = await api.getUsers()
      this.users = users
    } catch (error) {
      this.error = error.message
    } finally {
      this.isLoading = false
    }
  }

  @Action addUser(userData: CreateUserData) {
    const newUser: User = {
      id: nanoid(),
      ...userData,
      createdAt: new Date(),
      status: 'active'
    }
    this.users = [...this.users, newUser]
  }

  @Action updateUser(id: string, updates: Partial<User>) {
    this.users = this.users.map(user =>
      user.id === id ? { ...user, ...updates } : user
    )
  }

  @Action deleteUser(id: string) {
    this.users = this.users.filter(user => user.id !== id)
    if (this.currentUserId === id) {
      this.currentUserId = null
    }
  }

  @Action setCurrentUser(id: string) {
    this.currentUserId = id
  }
}
```

### 3. è¡¨å•çŠ¶æ€ç®¡ç†

```typescript
interface FormField<T = any> {
  value: T
  error: string | null
  touched: boolean
  dirty: boolean
}

class FormStore<T extends Record<string, any>> extends ObservableClass {
  @Observable fields: Record<keyof T, FormField> = {} as any
  @Observable isSubmitting = false
  @Observable submitError: string | null = null

  constructor(initialValues: T) {
    super()
    this.initializeFields(initialValues)
  }

  @Action private initializeFields(values: T) {
    const fields = {} as Record<keyof T, FormField>
    Object.keys(values).forEach(key => {
      fields[key as keyof T] = {
        value: values[key as keyof T],
        error: null,
        touched: false,
        dirty: false
      }
    })
    this.fields = fields
  }

  @Computed get values(): T {
    const values = {} as T
    Object.keys(this.fields).forEach(key => {
      values[key as keyof T] = this.fields[key].value
    })
    return values
  }

  @Computed get errors() {
    const errors: Partial<Record<keyof T, string>> = {}
    Object.keys(this.fields).forEach(key => {
      const field = this.fields[key as keyof T]
      if (field.error) {
        errors[key as keyof T] = field.error
      }
    })
    return errors
  }

  @Computed get isValid() {
    return Object.values(this.fields).every(field => !field.error)
  }

  @Computed get isDirty() {
    return Object.values(this.fields).some(field => field.dirty)
  }

  @Action setFieldValue<K extends keyof T>(name: K, value: T[K]) {
    const field = this.fields[name]
    this.fields = {
      ...this.fields,
      [name]: {
        ...field,
        value,
        dirty: true
      }
    }
  }

  @Action setFieldError<K extends keyof T>(name: K, error: string | null) {
    const field = this.fields[name]
    this.fields = {
      ...this.fields,
      [name]: {
        ...field,
        error
      }
    }
  }

  @Action touchField<K extends keyof T>(name: K) {
    const field = this.fields[name]
    this.fields = {
      ...this.fields,
      [name]: {
        ...field,
        touched: true
      }
    }
  }

  @Action async submit(onSubmit: (values: T) => Promise<void>) {
    if (!this.isValid) return

    this.isSubmitting = true
    this.submitError = null

    try {
      await onSubmit(this.values)
    } catch (error) {
      this.submitError = error.message
    } finally {
      this.isSubmitting = false
    }
  }

  @Action reset(values?: Partial<T>) {
    if (values) {
      this.initializeFields({ ...this.values, ...values })
    } else {
      Object.keys(this.fields).forEach(key => {
        const field = this.fields[key as keyof T]
        this.fields = {
          ...this.fields,
          [key]: {
            ...field,
            error: null,
            touched: false,
            dirty: false
          }
        }
      })
    }
    this.isSubmitting = false
    this.submitError = null
  }
}

// ä½¿ç”¨ç¤ºä¾‹
interface LoginForm {
  email: string
  password: string
}

const loginForm = new FormStore<LoginForm>({
  email: '',
  password: ''
})

// å­—æ®µæ›´æ–°
loginForm.setFieldValue('email', 'user@example.com')
loginForm.setFieldValue('password', 'password123')

// è¡¨å•æäº¤
loginForm.submit(async (values) => {
  await api.login(values)
})
```

## æ€§èƒ½ä¼˜åŒ–

### 1. æ‰¹å¤„ç†æ›´æ–°
```typescript
// è‡ªåŠ¨æ‰¹å¤„ç† (æ¨è)
@Action updateMultiple() {
  this.name = 'New Name'
  this.age = 30
  this.email = 'new@example.com'
  // è¿™äº›æ›´æ–°ä¼šè‡ªåŠ¨æ‰¹å¤„ç†
}

// æ‰‹åŠ¨æ‰¹å¤„ç†
batch(() => {
  name.value = 'New Name'
  age.value = 30
  email.value = 'new@example.com'
})
```

### 2. è®¡ç®—å€¼ç¼“å­˜
```typescript
class DataStore extends ObservableClass {
  @Observable rawData: Item[] = []

  // è®¡ç®—å€¼ä¼šè‡ªåŠ¨ç¼“å­˜
  @Computed get expensiveCalculation() {
    console.log('Computing...') // åªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰ä¼šæ‰§è¡Œ
    return this.rawData
      .filter(item => item.active)
      .map(item => processItem(item))
      .sort((a, b) => a.priority - b.priority)
  }
}
```

### 3. æ¡ä»¶å“åº”
```typescript
class ConditionalStore extends ObservableClass {
  @Observable isEnabled = false
  @Observable data: string[] = []

  constructor() {
    super()
    
    // åªæœ‰åœ¨å¯ç”¨æ—¶æ‰å“åº”æ•°æ®å˜åŒ–
    effect(() => {
      if (this.isEnabled) {
        console.log('Data updated:', this.data)
      }
    })
  }
}
```

## æµ‹è¯•

### å•å…ƒæµ‹è¯•ç¤ºä¾‹
```typescript
import { describe, it, expect, vi } from 'vitest'
import { signal, effect, createAction, ObservableClass } from '@eficy/reactive'

describe('Reactive System', () => {
  it('should trigger effects when signal changes', () => {
    const count = signal(0)
    const spy = vi.fn()

    effect(() => {
      spy(count.value)
    })

    expect(spy).toHaveBeenCalledWith(0)

    count.value = 5
    expect(spy).toHaveBeenCalledWith(5)
    expect(spy).toHaveBeenCalledTimes(2)
  })

  it('should batch action updates', () => {
    class TestStore extends ObservableClass {
      @Observable a = 0
      @Observable b = 0

      @Action updateBoth(a: number, b: number) {
        this.a = a
        this.b = b
      }
    }

    const store = new TestStore()
    const spy = vi.fn()

    effect(() => {
      spy(store.a + store.b)
    })

    expect(spy).toHaveBeenCalledTimes(1)

    store.updateBoth(5, 10)
    expect(spy).toHaveBeenCalledTimes(2) // åªè§¦å‘ä¸€æ¬¡
    expect(spy).toHaveBeenLastCalledWith(15)
  })

  it('should cache computed values', () => {
    const a = signal(1)
    const b = signal(2)
    const spy = vi.fn()

    const sum = computed(() => {
      spy()
      return a.value + b.value
    })

    // ç¬¬ä¸€æ¬¡è®¿é—®
    expect(sum.value).toBe(3)
    expect(spy).toHaveBeenCalledTimes(1)

    // é‡å¤è®¿é—®ä¸ä¼šé‡æ–°è®¡ç®—
    expect(sum.value).toBe(3)
    expect(spy).toHaveBeenCalledTimes(1)

    // ä¾èµ–å˜åŒ–åé‡æ–°è®¡ç®—
    a.value = 5
    expect(sum.value).toBe(7)
    expect(spy).toHaveBeenCalledTimes(2)
  })
})
```

## æœ€ä½³å®è·µ

### 1. ä¸å¯å˜æ›´æ–°
```typescript
// âœ… æ­£ç¡® - ä¸å¯å˜æ›´æ–°
@Action addItem(item: Item) {
  this.items = [...this.items, item]
}

@Action updateItem(id: string, updates: Partial<Item>) {
  this.items = this.items.map(item =>
    item.id === id ? { ...item, ...updates } : item
  )
}

@Action removeItem(id: string) {
  this.items = this.items.filter(item => item.id !== id)
}

// âŒ é”™è¯¯ - ç›´æ¥ä¿®æ”¹
@Action addItem(item: Item) {
  this.items.push(item) // ä¸ä¼šè§¦å‘æ›´æ–°
}
```

### 2. åˆç†ä½¿ç”¨è®¡ç®—å€¼
```typescript
class UserStore extends ObservableClass {
  @Observable users: User[] = []
  @Observable filter: string = ''

  // âœ… å¥½çš„è®¡ç®—å€¼ - çº¯å‡½æ•°
  @Computed get filteredUsers() {
    return this.users.filter(user => 
      user.name.toLowerCase().includes(this.filter.toLowerCase())
    )
  }

  // âŒ é¿å…å‰¯ä½œç”¨
  @Computed get filteredUsersWithSideEffect() {
    const filtered = this.users.filter(user => 
      user.name.includes(this.filter)
    )
    // âŒ ä¸è¦åœ¨è®¡ç®—å€¼ä¸­äº§ç”Ÿå‰¯ä½œç”¨
    console.log('Filtered users:', filtered)
    return filtered
  }
}
```

### 3. æ­£ç¡®çš„é”™è¯¯å¤„ç†
```typescript
class DataStore extends ObservableClass {
  @Observable data: Item[] = []
  @Observable isLoading = false
  @Observable error: string | null = null

  @Action async loadData() {
    this.isLoading = true
    this.error = null

    try {
      const data = await api.getData()
      this.data = data
    } catch (error) {
      this.error = error instanceof Error ? error.message : 'Unknown error'
    } finally {
      this.isLoading = false
    }
  }
}
```

### 4. ç»„ä»¶è§£è€¦
```typescript
// âœ… å¥½çš„è®¾è®¡ - å•ä¸€èŒè´£
class UserListStore extends ObservableClass {
  @Observable users: User[] = []
  @Observable isLoading = false

  @Action loadUsers() { /* ... */ }
  @Action addUser(user: User) { /* ... */ }
}

class UserFilterStore extends ObservableClass {
  @Observable filter = ''
  @Observable sortBy: 'name' | 'date' = 'name'

  @Action setFilter(filter: string) { /* ... */ }
  @Action setSortBy(sortBy: typeof this.sortBy) { /* ... */ }
}

// âŒ é¿å…çš„è®¾è®¡ - èŒè´£è¿‡å¤š
class MonolithicUserStore extends ObservableClass {
  // ç”¨æˆ·æ•°æ®
  @Observable users: User[] = []
  @Observable isLoading = false
  
  // è¿‡æ»¤é€»è¾‘
  @Observable filter = ''
  @Observable sortBy = 'name'
  
  // UI çŠ¶æ€
  @Observable selectedUser: User | null = null
  @Observable showModal = false
  
  // è¿‡å¤šçš„èŒè´£...
}
```

## è¿ç§»æŒ‡å—

### ä» MobX è¿ç§»

#### 1. å¯¼å…¥æ›´æ–°
```typescript
// MobX
import { Observable, Computed, Action, makeObservable } from 'mobx'

// @eficy/reactive
import { Observable, Computed, Action, makeObservable, ObservableClass } from '@eficy/reactive'
```

#### 2. æ•°ç»„æ“ä½œæ›´æ–°
```typescript
// MobX é£æ ¼
@Action addItem(item: Item) {
  this.items.push(item) // ç›´æ¥ä¿®æ”¹
}

// @eficy/reactive é£æ ¼
@Action addItem(item: Item) {
  this.items = [...this.items, item] // ä¸å¯å˜æ›´æ–°
}
```

#### 3. ç±»å®šä¹‰æ›´æ–°
```typescript
// MobX
class Store {
  items = []
  
  constructor() {
    makeObservable(this, {
      items: observable,
      count: computed,
      addItem: action
    })
  }
  
  get count() { return this.items.length }
  addItem(item) { this.items.push(item) }
}

// @eficy/reactive
class Store extends ObservableClass {
  @Observable items = []
  
  @Computed get count() { return this.items.length }
  
  @Action addItem(item) {
    this.items = [...this.items, item]
  }
}
```

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸å¯å˜æ›´æ–°ï¼Ÿ
A: ä¸å¯å˜æ›´æ–°ç¡®ä¿ï¼š
1. æ›´å¯é çš„å“åº”å¼è§¦å‘
2. æ›´å¥½çš„æ€§èƒ½ä¼˜åŒ–æœºä¼š  
3. æ›´å®¹æ˜“çš„è°ƒè¯•å’Œæ—¶é—´æ—…è¡Œ
4. ä¸ React ç­‰æ¡†æ¶çš„æ›´å¥½é›†æˆ

### Q: ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è£…é¥°å™¨ vs å‡½æ•°å¼ APIï¼Ÿ
A: 
- **è£…é¥°å™¨é£æ ¼**ï¼šé€‚åˆé¢å‘å¯¹è±¡çš„ä»£ç ï¼Œç±»ç»“æ„æ¸…æ™°
- **å‡½æ•°å¼é£æ ¼**ï¼šé€‚åˆå‡½æ•°å¼ç¼–ç¨‹é£æ ¼ï¼Œæ›´çµæ´»çš„ç»„åˆ

### Q: å¦‚ä½•è°ƒè¯•å“åº”å¼æ›´æ–°ï¼Ÿ
A: 
1. ä½¿ç”¨ `createDebugger` å·¥å…·
2. åœ¨ effect ä¸­æ·»åŠ  console.log
3. ä½¿ç”¨æµè§ˆå™¨çš„ React DevTools
4. æ£€æŸ¥ signal.value çš„å˜åŒ–

### Q: æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼Ÿ
A: 
1. ä½¿ç”¨ @Action æ‰¹å¤„ç†æ›´æ–°
2. é¿å…åœ¨ @Computed ä¸­äº§ç”Ÿå‰¯ä½œç”¨
3. åˆç†æ‹†åˆ†å¤§å‹ store
4. ä½¿ç”¨æ¡ä»¶ effect é¿å…ä¸å¿…è¦çš„è®¡ç®—

---

æ­¤æ–‡æ¡£ä¸º @eficy/reactive çš„å®Œæ•´ LLM å‚è€ƒæ–‡æ¡£ï¼Œæ¶µç›–äº†å“åº”å¼ç³»ç»Ÿçš„æ‰€æœ‰æ ¸å¿ƒæ¦‚å¿µã€API ä½¿ç”¨ã€æœ€ä½³å®è·µå’Œè¿ç§»æŒ‡å—ã€‚ 