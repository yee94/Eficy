# å·¥ä½œæµä¾èµ–å…³ç³»è¯´æ˜

## ğŸ“Š ä¾èµ–å…³ç³»å›¾

```mermaid
graph TD
    A[install] --> B[build]
    B --> C[test]
    B --> D[typecheck]
    C --> E[version]
    D --> E
    E --> F[create-release]
    
    G[changeset] --> H[PR Check]
    H --> I[install]
    I --> J[build]
    J --> K[test]
    J --> L[typecheck]
    I --> M[security]
```

## ğŸ”„ å·¥ä½œæµè¯´æ˜

### 1. CI å·¥ä½œæµ (`.github/workflows/ci.yml`)

**ä¾èµ–å…³ç³»**ï¼š
- `install` â†’ `build` â†’ `test` / `typecheck`

**æ‰§è¡Œé¡ºåº**ï¼š
1. **install**: å®‰è£…ä¾èµ–å¹¶ç¼“å­˜
2. **build**: æ„å»ºæ‰€æœ‰åŒ…ï¼ˆä¾èµ– installï¼‰
3. **test**: è¿è¡Œæµ‹è¯•ï¼ˆä¾èµ– buildï¼‰- æ”¯æŒ Node.js 18, 20, 22
4. **typecheck**: ç±»å‹æ£€æŸ¥ï¼ˆä¾èµ– build + é‡æ–°æ„å»ºï¼‰

### 2. PR æ£€æŸ¥å·¥ä½œæµ (`.github/workflows/pr-check.yml`)

**ä¾èµ–å…³ç³»**ï¼š
- `install` â†’ `build` â†’ `test` / `typecheck`
- `install` â†’ `security`

**æ‰§è¡Œé¡ºåº**ï¼š
1. **install**: å®‰è£…ä¾èµ–å¹¶ç¼“å­˜
2. **build**: æ„å»ºæ‰€æœ‰åŒ…ï¼ˆä¾èµ– installï¼‰
3. **test**: è¿è¡Œæµ‹è¯•ï¼ˆä¾èµ– buildï¼‰
4. **typecheck**: ç±»å‹æ£€æŸ¥ï¼ˆä¾èµ– build + é‡æ–°æ„å»ºï¼‰
5. **security**: å®‰å…¨å®¡è®¡ï¼ˆä¾èµ– installï¼‰

### 3. å‘å¸ƒå·¥ä½œæµ (`.github/workflows/release.yml`)

**ä¾èµ–å…³ç³»**ï¼š
- `install` â†’ `build` â†’ `test` / `typecheck` â†’ `version` â†’ `create-release`

**æ‰§è¡Œé¡ºåº**ï¼š
1. **install**: å®‰è£…ä¾èµ–å¹¶ç¼“å­˜
2. **build**: æ„å»ºæ‰€æœ‰åŒ…ï¼ˆä¾èµ– installï¼‰
3. **test**: è¿è¡Œæµ‹è¯•ï¼ˆä¾èµ– buildï¼‰
4. **typecheck**: ç±»å‹æ£€æŸ¥ï¼ˆä¾èµ– build + é‡æ–°æ„å»ºï¼‰
5. **version**: åˆ›å»ºç‰ˆæœ¬ PRï¼ˆä¾èµ– test + typecheckï¼‰
6. **create-release**: åˆ›å»º GitHub Releaseï¼ˆä¾èµ– versionï¼‰

### 4. Changesets PR å·¥ä½œæµ (`.github/workflows/changeset-pr.yml`)

**ä¾èµ–å…³ç³»**ï¼š
- ç‹¬ç«‹æ‰§è¡Œï¼Œæ— ä¾èµ–

**æ‰§è¡Œé¡ºåº**ï¼š
1. **changeset**: æ£€æŸ¥ changesets

## ğŸ¯ å…³é”®è®¾è®¡åŸåˆ™

### 1. ä¾èµ–ç¼“å­˜
- `install` ä»»åŠ¡ä¸Šä¼  `node_modules` ä½œä¸º artifact
- åç»­ä»»åŠ¡ä¸‹è½½ä¾èµ–ï¼Œé¿å…é‡å¤å®‰è£…

### 2. æ„å»ºäº§ç‰©å…±äº«
- `build` ä»»åŠ¡ä¸Šä¼ æ„å»ºäº§ç‰©
- `test` å’Œ `typecheck` ä»»åŠ¡ä¸‹è½½æ„å»ºäº§ç‰©
- ç¡®ä¿ç±»å‹æ£€æŸ¥åŸºäºæœ€æ–°çš„æ„å»ºç»“æœ

### 3. å¹¶è¡Œæ‰§è¡Œ
- `test` å’Œ `typecheck` å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
- éƒ½ä¾èµ– `build` å®Œæˆ

### 4. å®‰å…¨å®¡è®¡
- `security` ä»»åŠ¡ç‹¬ç«‹æ‰§è¡Œ
- åªä¾èµ–ä¾èµ–å®‰è£…ï¼Œä¸ä¾èµ–æ„å»º

### 5. ç±»å‹æ£€æŸ¥æ„å»º
- `typecheck` ä»»åŠ¡åœ¨è¿è¡Œç±»å‹æ£€æŸ¥å‰ä¼šé‡æ–°æ„å»ºæ‰€æœ‰åŒ…
- ç¡®ä¿æ‰€æœ‰åŒ…çš„ç±»å‹å£°æ˜éƒ½æ˜¯æœ€æ–°çš„
- è§£å†³ monorepo ä¸­åŒ…ä¹‹é—´çš„ç±»å‹ä¾èµ–é—®é¢˜

### 6. Node.js ç‰ˆæœ¬æ”¯æŒ
- é»˜è®¤ä½¿ç”¨ Node.js 22
- æ”¯æŒ Node.js 18, 20, 22 çš„çŸ©é˜µæµ‹è¯•
- ä½¿ç”¨ pnpm 9.12.3ï¼ˆéœ€è¦ Node.js 18.12+ï¼‰

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥
```yaml
# ä¾èµ–ç¼“å­˜
- name: Upload dependencies
  uses: actions/upload-artifact@v4
  with:
    name: node-modules
    path: node_modules
    retention-days: 1
```

### 2. æ„å»ºäº§ç‰©ç¼“å­˜
```yaml
# æ„å»ºäº§ç‰©ç¼“å­˜
- name: Upload build artifacts
  uses: actions/upload-artifact@v4
  with:
    name: build-artifacts
    path: |
      packages/*/dist
      packages/*/lib
    retention-days: 7
```

### 3. ä¾èµ–å…³ç³»ä¼˜åŒ–
- ç±»å‹æ£€æŸ¥å¿…é¡»åœ¨æ„å»ºå®Œæˆåæ‰§è¡Œ
- æµ‹è¯•å¿…é¡»åœ¨æ„å»ºå®Œæˆåæ‰§è¡Œ
- å‘å¸ƒå¿…é¡»åœ¨æµ‹è¯•å’Œç±»å‹æ£€æŸ¥éƒ½é€šè¿‡åæ‰§è¡Œ
- ç±»å‹æ£€æŸ¥å‰éœ€è¦é‡æ–°æ„å»ºä»¥ç¡®ä¿ç±»å‹å£°æ˜æœ€æ–°

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç±»å‹æ£€æŸ¥å¤±è´¥**
   - ç¡®ä¿æ„å»ºæˆåŠŸ
   - æ£€æŸ¥ TypeScript é…ç½®
   - éªŒè¯ä¾èµ–å…³ç³»
   - ç¡®ä¿æ‰€æœ‰åŒ…éƒ½å·²æ„å»º

2. **æµ‹è¯•å¤±è´¥**
   - ç¡®ä¿æ„å»ºæˆåŠŸ
   - æ£€æŸ¥æµ‹è¯•ç¯å¢ƒ
   - éªŒè¯ä¾èµ–å®‰è£…

3. **æ„å»ºå¤±è´¥**
   - æ£€æŸ¥ä¾èµ–å®‰è£…
   - éªŒè¯æ„å»ºé…ç½®
   - æ£€æŸ¥åŒ…ç»“æ„

4. **åŒ…é—´ä¾èµ–é”™è¯¯**
   - ç¡®ä¿ä¾èµ–åŒ…å·²æ„å»º
   - æ£€æŸ¥ workspace é…ç½®
   - éªŒè¯åŒ…å¼•ç”¨è·¯å¾„

5. **Node.js ç‰ˆæœ¬é”™è¯¯**
   - ç¡®ä¿ä½¿ç”¨ Node.js 18.12+ ä»¥æ”¯æŒ pnpm 9.12.3
   - æ¨èä½¿ç”¨ Node.js 22 ä»¥è·å¾—æœ€ä½³æ€§èƒ½

### è°ƒè¯•æ­¥éª¤

1. æ£€æŸ¥ `install` ä»»åŠ¡æ˜¯å¦æˆåŠŸ
2. æ£€æŸ¥ `build` ä»»åŠ¡æ˜¯å¦æˆåŠŸ
3. æ£€æŸ¥ `test` å’Œ `typecheck` ä»»åŠ¡
4. æ£€æŸ¥ artifact ä¸Šä¼ /ä¸‹è½½æ˜¯å¦æˆåŠŸ
5. æ£€æŸ¥åŒ…æ„å»ºé¡ºåºæ˜¯å¦æ­£ç¡®
6. éªŒè¯ Node.js ç‰ˆæœ¬å…¼å®¹æ€§
